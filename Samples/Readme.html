<html>
    <head>
        <title>Empty package sample walkthrough</title>
        <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
        <style>
            .code {
                font-family: Consolas, 'Courier New', monospace;
                font-size: 0.8em;
            }
        </style>
    </head>
    <body>
        <h1>Empty package sample walkthrough</h1>
        <p>
            This readme contains the required steps to create an empty package
            with the NetIde system. This walkthrough assumes that you're linking
            to the source.
        </p>
        <p>
            The name of this project is <span class="code">NetIde.Samples.EmptyPackage</span>.
            When creating your own package, change all references to this name
            with the name of your project.
        </p>
        <p>
            The NetIde system makes use of contexts. A context is a specific NetIde
            application. The usage of contexts enables different NetIde applications
            to be installed on a single machine. The name of the context of this
            sample project is <span class="code">NetIdeEmptyPackageSample</span>.
            For your package, you need to define your own unique context name as
            this will also be used for the NuGet package. When creating your own
            project, change all references to this name with the name of your
            context.
        </p>
        <p>
            All installation is done automatically, except for the initial setup
            of the context. This must be done manually, or through a setup. Complete
            the following steps to manually create a new context:
        </p>
        <ul>
            <li>
                <p>
                    Create a new registry key named <span class="code">HKCU:Software\Net IDE\NetIdeEmptyPackageSample</span>.
                </p>
            </li>
            <li>
                <p>
                    Add a new string value named <span class="code">InstallationPath</span> and
                    set the value to the full path of the <span class="code">bin\Debug</span>
                    directory of your project.
                </p>
            </li>
        </ul>
        <p>
            The following steps creates a fully functional empty package:
        </p>
        <ul>
            <li>
                <p>
                    Create a new <b>Class Project</b> named <span class="code">NetIde.Samples.EmptyPackage</span>
                    and remove the <span class="code">Class1.cs</span> file.
                </p>
            </li>
            <li>
                <p>
                    Add the following <b>references</b> to the project:
                    <ul>
                        <li>
                            <span class="code">NetIde.Shell</span>
                        </li>
                        <li>
                            <span class="code">NetIde.Shell.Interop.1.0</span>
                        </li>
                        <li>
                            <span class="code">NetIde.Shell.Settings</span>
                        </li>
                        <li>
                            <span class="code">NetIde.Util</span>
                        </li>
                        <li>
                            <span class="code">System.Windows.Forms</span>
                        </li>
                        <li>
                            <span class="code">System.Drawing</span>
                        </li>
                    </ul>
                </p>
            </li>
            <li>
                <p>
                    Add the following <b>project dependencies</b> to the project:
                    <ul>
                        <li>
                            <span class="code">NetIde</span>
                        </li>
                        <li>
                            <span class="code">NetIde.Core</span>
                        </li>
                        <li>
                            <span class="code">NetIde.Install</span>
                        </li>
                        <li>
                            <span class="code">NetIde.TransformResources</span>
                        </li>
                    </ul>
                </p>
            </li>
            <li>
                <p><b>Strongly sign</b> the project.</p>
            </li>
            <li>
                <p>
                    <b>Create a splash image</b> and name it <span class="code">Splash.png</span>.
                    This file must be added to the root of the project and
                    the <b>Copy to Output</b> property must be set to <b>Copy always</b>.
                </p>
            </li>
            <li>
                <p>
                    Add a <b>resource file</b> named <span class="code">Labels.resx</span>
                    and <b>add a string resource</b> <span class="code">PackageDescription</span>
                    with a short name for the package as the value.
                </p>
            </li>
            <li>
                <p>
                    <b>Add the icon</b> for your application to the <span class="code">Resources</span>
                    folder of your project and name it <span class="code">MainIcon.ico</span>.
                </p>
            </li>
            <li>
                <p>
                    Set the <b>Build Action</b> of the <span class="code">MainIcon.ico</span>
                    file to <b>Embedded Resource</b>. Resources in Net IDE are made available to
                    the system through <span class="code">IResource</span> instances. For this
                    to work, resources must be an embedded resource.
                </p>
            </li>
            <li>
                <p>
                    Add a <b>resource file</b> named <span class="code">NiResources.resx</span>.
                    and <b>add the <span class="code">MainIcon.ico</span> icon</b> to it. The
                    <span class="code">MainIcon.ico</span> is also added to the resources file
                    because it's used in the package class below.
                </p>
            </li>
            <li>
                <p>
                    <b>Create a menu template.</b> For now this template is empty and in
                    a later walkthrough menu items will be added to this template.
                </p>
                <p>
                    To create the template, add an XML file named <span class="code">NiMenu.Template.xml</span>
                    to the <span class="code">Resources</span> directory and paste the following
                    contents into it.
                </p>
                <pre class="prettyprint">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;resources xmlns=&quot;https://github.com/pvginkel/NetIde/schemas/Resources&quot;&gt;
  &lt;imports&gt;
    &lt;import from=&quot;..\..\..\NetIde.Shell\bin\Debug\NetIde.Shell.dll&quot; type=&quot;NetIde.Shell.NiResources&quot; prefix=&quot;Ni_&quot; /&gt;
  &lt;/imports&gt;
  &lt;ui&gt;&lt;/ui&gt;
&lt;/resources&gt;
</pre>
                <p>
                    The path must point to the <span class="code">NetIde.Shell.dll</span>
                    file. Adjust it as necessary.
                </p>
                <p>
                    To transform this template into a valid Net IDE menu XML file, the following
                    <b>Pre-build</b> <b>Build Event</b> must be added to your project:
                </p>
                <pre>
$(SolutionDir)\NetIde.TransformResources\bin\$(ConfigurationName)\nixfresource.exe /file $(ProjectDir)\Resources\NiMenu.Template.xml /target $(ProjectDir)\Resources\NiMenu.xml
</pre>
                <p>
                    If you now compile your project, a file named <span class="code">NiMenu.xml</span>
                    will appear next to the template. <b>Add this file to the <span class="code">NiResources.resx</span>
                                                          resource file.</b>
                </p>
            </li>
            <li>
                <p>
                    <b>Add an XML file named <span class="code">NiContext.xml</span></b> to
                    the root of your project. This file defines the context for Net IDE.
                    While debugging, Net IDE will find this file automatically based on
                    the working directory (it looks up the file hierarchy until it finds
                    the file). In production, this file must be added to the installation folder.
                </p>
                <p>
                    <b>Paste the following contents</b> into the XML file:
                </p>
                <pre class="prettyprint">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;context name=&quot;NetIdeEmptyPackageSample&quot;
         nuGetSite=&quot;https://nuget.org/api/v2/&quot;
         xmlns=&quot;https://github.com/pvginkel/NetIde/schemas/Context&quot; /&gt;
</pre>
                <p>
                    Replace <span class="code">NetIdeEmptyPackageSample</span>
                    with the name of your context. This example uses the public
                    NuGet website for package distribution. You can replace this with
                    a local NuGet installation to use on-site distribution.
                </p>
            </li>
            <li>
                <p>
                    <b>Add an XML file named <span class="code">NiPackage.manifest</span></b> to
                    the root of your project and set the <b>Copy to Output</b> property to <b>Copy always</b>.
                    The <span class="code">NiPackage.manifest</span> defines a manifest
                    for your package and is used by the package management system
                    to identify your package.
                </p>
                <p>
                    <b>Paste the following contents</b> into the XML file:
                </p>
                <pre class="prettyprint">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;manifest xmlns=&quot;https://github.com/pvginkel/NetIde/schemas/PackageManifest&quot;&gt;
  &lt;entryPoint&gt;NetIde.Samples.EmptyPackage.EmptyPackageSample, NetIde.Samples.EmptyPackage&lt;/entryPoint&gt;
&lt;/manifest&gt;
</pre>
                <p>
                    Replace the namespace and the assembly name with the namespace
                    and assembly name of your package.
                </p>
            </li>
            <li>
                <p>
                    <b>Add a class named <span class="code">Resources</span></b> to the
                    root of your project and paste the following code into it:
                </p>
                <pre class="prettyprint">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using NetIde.Shell;
using NetIde.Shell.Interop;

namespace NetIde.Samples.EmptyPackage
{
    internal static class Resources
    {
        public static IResource MainIcon = GetResource("MainIcon.ico");

        private static IResource GetResource(string resourceKey)
        {
            return ResourceUtil.FromManifestResourceStream(
                typeof(Resources).Assembly,
                typeof(Resources).Namespace + ".Resources." + resourceKey
            );
        }
    }
}
</pre>
                <p>
                    As stated before, resources in Net IDE are managed using
                    <span class="code">IResource</span> instances. Classes that
                    implement this interface allow for binary data to be marshalled
                    between your package and the Net IDE system. The example above shows
                    how you can easily create resources based on embedded resources.
                    The <span class="code">GetResource()</span> method creates a
                    resource based on an embedded resource in the
                    <span class="code">Resources</span> folder.
                </p>
            </li>
            <li>
                <p>
                    <b>Create a NuGet manifest.</b> Net IDE packages are basically
                    NuGet packages.
                </p>
                <p>
                    The following is an example of a NuGet package that is valid
                    for the Net IDE system:
                </p>
                <pre class="prettyprint">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;package xmlns=&quot;http://schemas.microsoft.com/packaging/2010/07/nuspec.xsd&quot;&gt;
  &lt;metadata&gt;
    &lt;id&gt;NetIdeEmptyPackageSample.Package.Core&lt;/id&gt;
    &lt;version&gt;$version$&lt;/version&gt;
    &lt;authors&gt;Pieter van Ginkel&lt;/authors&gt;
    &lt;title&gt;NetIde Empty Package Sample&lt;/title&gt;
    &lt;description&gt;NetIde Empty Package Sample.&lt;/description&gt;
    &lt;dependencies&gt;
      &lt;dependency id=&quot;NetIde.Package.Core&quot; version=&quot;0.0.0.0&quot; /&gt;
    &lt;/dependencies&gt;
  &lt;/metadata&gt;
  &lt;files&gt;
    &lt;file src=&quot;..\Samples\NetIde.Samples.EmptyPackage\bin\Debug\**&quot; target=&quot;Tools&quot; exclude=&quot;..\Samples\NetIde.Samples.EmptyPackage\bin\Debug\**.pdb;..\Samples\NetIde.Samples.EmptyPackage\bin\Debug\**.xml;..\Samples\NetIde.Samples.EmptyPackage\bin\Debug\Packages\**&quot; /&gt;
  &lt;/files&gt;
&lt;/package&gt;
</pre>
                <p>
                    There are a few things you have to take into account when creating
                    NuGet manifests for Net IDE:
                </p>
                <ul>
                    <li>
                        <p>
                            The files need to be in the <span class="code">Tools</span>
                            directory of the NuGet package. This is the only folder
                            Net IDE looks in.
                        </p>
                    </li>
                    <li>
                        <p>
                            The package needs to have a <span class="code">NiPackage.manifest</span>
                            file. This file identifies the package as a Net IDE package and tells
                            Net IDE how to use your package.
                        </p>
                    </li>
                    <li>
                        <p>
                            The name of the package needs to be
                            <span class="code"><i>Context name</i>.Package.<i>Package name</i></span>.
                            The package installation UI of Net IDE specifically filters
                            on packages that start for the name of your context
                            followed by <span class="code">.Package.</span>.
                        </p>
                    </li>
                </ul>
            </li>
            <li>
                <p>
                    <b>Add the entry point for your package</b> to the
                    root of your project. In our example, we will name it
                    <span class="code">EmptyPackageSample</span>. The
                    <span class="code">NiPackage.manifest</span> contains a reference
                    to this class and Net IDE will use this class to load your package.
                </p>
                <p>
                    Paste the following code into the file you just created:
                </p>
                <pre class="prettyprint">
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Linq;
using System.Runtime.InteropServices;
using System.Text;
using System.Windows.Forms;
using NetIde.Shell;
using NetIde.Shell.Interop;

namespace NetIde.Samples.EmptyPackage
{
    // Unique GUID for your package.
    [Guid("586bf7e4-a5aa-4cb9-95e0-00a7227809ff")]
    // The name or resource which contains the description of your package.
    [Description("@PackageDescription")]
    // The name of the resource file that contains resources you want to make
    // available to Net IDE.
    [NiResources("NiResources")]
    // The name of the localized resource file which is used to resolve string
    // resources like the PackageDescription above.
    [NiStringResources("Labels")]
    // The name of the splash image. This is not an embedded resource and needs
    // to be in the Tools directory of the NuGet package.
    [ProvideStartupSplashImage("Splash.png")]
    public sealed class EmptyPackageSample : NiPackage
    {
        public INiEnv Env { get; private set; }

        public override HResult Initialize()
        {
            try
            {
                var hr = base.Initialize();
                if (ErrorUtil.Failure(hr))
                    return hr;

                Env = (INiEnv)GetService(typeof(INiEnv));
                    
                // Initialize the main window of Net IDE.
                Env.MainWindow.Caption = Labels.PackageDescription;
                Env.MainWindow.Icon = Resources.MainIcon;

                return HResult.OK;
            }
            catch (Exception ex)
            {
                return ErrorUtil.GetHResult(ex);
            }
        }
    }
}
</pre>
                <p>
                    The above code uses a GUID to identify the project. In the
                    example above, this GUID is hard coded. In a later walkthrough,
                    this will be replaced by a centrally stored location.
                </p>
            </li>
            <li>
                <p>
                    <b>Change the project configuration to use
                        <span class="code">netide.exe</span> to start your project.</b>
                    The <span class="code">netide.exe</span> application is the main
                    shell of Net IDE.
                </p>
                <p>
                    There are two ways in which you can configure your project
                    to use <span class="code">netide.exe</span>. The first is a temporary
                    configuration which you can set in the project settings of your
                    class library. However, it is also possible to change your
                    <span class="code">.csproj</span> file to permanently use
                    <span class="code">netide.exe</span> to start your project.
                    The steps below are used to apply that configuration:
                </p>
                <ul>
                    <li>
                        <p>
                            <b>Unload the project.</b> Right click on the project in
                            the solution explorer and click <b>Unload Project</b>.
                        </p>
                    </li>
                    <li>
                        <p>
                            <b>Open the <span class="code">.csproj</span> file.</b>
                            Right click on the unloaded project and click
                            <b>Edit <i>Project name</i>.csproj</b>.
                        </p>
                    </li>
                    <li>
                        <p>
                            <b>Locate the debug configuration section for the project.</b>
                            The debug configuration of your project is the
                            <span class="code">PropertyGroup</span> element that looks like
                            this:
                        </p>
                        <pre class="prettyprint">
&lt;PropertyGroup Condition=&quot; &#39;$(Configuration)|$(Platform)&#39; == &#39;Debug|AnyCPU&#39; &quot;&gt;
</pre>
                    </li>
                    <li>
                        <p>
                            <b>Replace the <span class="code">OutputPath</span> element</b>
                            with the following XML:
                        </p>
                        <pre class="prettyprint">
&lt;OutputPath&gt;$(MSBuildProjectDirectory)\bin\Debug\&lt;/OutputPath&gt;
</pre>
                    </li>
                    <li>
                        <p>
                            <b>Add the following XML to the end of the debug
                                configuration:</b>
                        </p>
                        <pre class="prettyprint">
&lt;StartAction&gt;Program&lt;/StartAction&gt;
&lt;StartProgram&gt;$(OutputPath)\..\..\..\..\NetIde\bin\Debug\NetIde.exe&lt;/StartProgram&gt;
</pre>
                    </li>
                    <li>
                        <p>
                            <b>Locate the release configuration section for the project.</b>
                            The release configuration of your project is the
                            <span class="code">PropertyGroup</span> element that looks like
                            this:
                        </p>
                        <pre class="prettyprint">
&lt;PropertyGroup Condition=&quot; &#39;$(Configuration)|$(Platform)&#39; == &#39;Release|AnyCPU&#39; &quot;&gt;
</pre>
                    </li>
                    <li>
                        <p>
                            <b>Replace the <span class="code">OutputPath</span> element</b>
                            with the following XML:
                        </p>
                        <pre class="prettyprint">
&lt;OutputPath&gt;$(MSBuildProjectDirectory)\bin\Release\&lt;/OutputPath&gt;
</pre>
                    </li>
                    <li>
                        <p>
                            <b>Add the following XML to the end of the release
                                configuration:</b>
                        </p>
                        <pre class="prettyprint">
&lt;StartAction&gt;Program&lt;/StartAction&gt;
&lt;StartProgram&gt;$(OutputPath)\..\..\..\..\NetIde\bin\Release\NetIde.exe&lt;/StartProgram&gt;
</pre>
                    </li>
                    <li>
                        <p>
                            <b>Reload the project</b> by right clicking on the
                            unloaded project and clicking <b>Reload Project</b>.
                            Accept any questions you get.
                        </p>
                    </li>
                </ul>
            </li>
            <li>
                <p>
                    To automatically build and install the NuGet package
                    during the compilation process, <b>add the following
                                                        Post-build to the Build Events of your project</b>:
                </p>
                <pre>
$(SolutionDir)\.nuget\nuget.exe pack $(SolutionDir)\Build\Configuration\NuGet\NetIdeEmptyPackageSample.Package.Core.nuspec -Version 0.0.0.0 -BasePath $(SolutionDir)\Build -NoPackageAnalysis
$(SolutionDir)\NetIde.Install\bin\$(ConfigurationName)\niinstall.exe /c NetIdeEmptyPackageSample $(SolutionDir)\NetIde.Core\bin\$(ConfigurationName)\NetIde.Package.Core.0.0.0.0.nupkg
$(SolutionDir)\NetIde.Install\bin\$(ConfigurationName)\niinstall.exe /c NetIdeEmptyPackageSample $(TargetDir)\NetIdeEmptyPackageSample.Package.Core.0.0.0.0.nupkg
</pre>
                <p>
                    The first line build the NuGet package based on your
                    NuGet package manifest. The second and third line installs both
                    your package and the Net IDE core package.
                </p>
            </li>
            <li>
                <p>
                    <b>Run your project.</b> You now have a complete Net IDE package
                    fully configured to develop and debug.
                </p>
            </li>
        </ul>
    </body>
</html>